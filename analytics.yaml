openapi: 3.0.0
info:
  title: Analytics
  version: '0.2'
  description: |-
    The Analytics API provides endpoints for querying current state, historical trends and summarisations of an environment and interactions within it.

    It is currently within an early release phase and will undergo regular breaking changes.

    **Not recommended for production use.**
servers:
  - url: 'https://place.ll-uat.aca.im'
    variables:
      host:
        default: place.ll-uat.aca.im
        description: Host where place is deployed.
    description: UAT infrastructure
paths:
  '/location/{id}/occupancy':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Location ID to query
    get:
      summary: Location Occupancy
      responses:
        '200':
          description: ''
          headers: {}
          content:
            application/json:
              schema:
                title: aggregate
                type: object
                x-examples: {}
                properties:
                  value:
                    type: number
                    minimum: 0
                    maximum: 1
                  confidence:
                    type: number
                    minimum: 0
                    maximum: 1
                required:
                  - value
                  - confidence
              examples: {}
        '204':
          description: No event data is available for the time requested. This will occur if `at` is prior to any data being available.
      operationId: get-location-id-occupancy
      description: |-
        Provides occupancy insights for a location.

        Occupancy is defined as usage of a location. This incudes rooms, desks, lockers and other assets. At any point in time it is always either `0.0` (available) or `1.0` (in use), however the confidence of this may vary. When querying a time range, the ratio of in use to available time during the window is returned.
      security:
        - API Key: []
      parameters:
        - schema:
            type: string
          in: query
          name: at
          description: A point in time (RFC3339) to query.
        - schema:
            type: string
          in: query
          name: start
          description: An RFC3339 timestamp with the start of the query range
        - schema:
            type: string
          in: query
          name: stop
          description: An RFC3339 timestamp with the end of the query range
      tags:
        - occupancy
        - location
  '/location/{id}/raw/{event}':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Location identifier
      - schema:
          type: string
        name: event
        in: path
        required: true
        description: Event type
    get:
      summary: Location Parameter History
      operationId: get-location-id-state-event
      responses:
        '200':
          description: The state at the requested time.
          content:
            application/json:
              schema:
                type: number
        '400':
          description: Bad Request. Returned if `at` is in the future.
        '':
          content:
            application/json:
              schema:
                type: number
                description: The value of the tracked parameter at the requested time
      description: Query the state of a tracked parameter at a specific point in time.
      parameters:
        - schema:
            type: string
          in: query
          name: at
          description: An RFC3339 timestamp. If excluded `now` is assumed.
        - schema:
            type: string
          in: query
          name: src
          description: Filter to a specific source type.
      tags:
        - history
  '/location/{id}/utilisation':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Location ID
    get:
      summary: Location Utilisation
      tags:
        - utilisation
        - location
      responses:
        '200':
          description: ''
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: number
                    minimum: 0
                    maximum: 1
                  confidence:
                    type: number
                    minimum: 0
                    maximum: 1
                required:
                  - value
                  - confidence
                x-examples: {}
                title: aggregate
              examples: {}
          headers: {}
      operationId: get-location-id-utilisation
      description: |-
        Utilisation insights for a location.

        Utilization provides a measure of capacity of a location to its detected usage. A location may be detected as occupied if for example a laptop, paperwork of other work materials are left on desk. If a person is not there are that point in time though, it would not be utilized.

        Similarly, if meeting room or collaboration spaces is designed to accomodate 6 people, but only 3 are detected, this would have a utilization of 0.5 for that point in time.
      parameters:
        - schema:
            type: string
          in: query
          name: at
          description: A point in time (RFC3339) to query.
        - schema:
            type: string
          in: query
          name: start
          description: An RFC3339 timestamp with the start of the query range
        - schema:
            type: string
          in: query
          name: stop
          description: An RFC3339 timestamp with the end of the query range
components:
  schemas:
    rfc3339:
      type: string
      title: RFC3339
      pattern: "/^(?<fullyear>\\d{4})-(?<month>0[1-9]|1[0-2])-(?<mday>0[1-9]|[12][0-9]|3[01])T(?<hour>[01][0-9]|2[0-3]):(?<minute>[0-5][0-9]):(?<second>[0-5][0-9]|60)(?<secfrac>\\.[0-9]+)?(Z|(\\+|-)(?<offset_hour>[01][0-9]|2[0-3]):(?<offset_minute>[0-5][0-9]))$/i"
      description: 'An [RFC3339](https://tools.ietf.org/html/rfc3339) date-time string'
      x-examples:
        Example: '2018-01-29T20:36:30+00:00'
  securitySchemes:
    API Key:
      name: X-API-Key
      type: apiKey
      in: header
      description: ''
tags:
  - name: metadata
    description: Queries providing metadata about a tracked entity
  - name: location
    description: Location queries
  - name: level
    description: Level queries
  - name: building
    description: Building queries
  - name: organisation
    description: Organistaion queries
  - name: state
    description: Queries providing historical state.
  - name: occupancy
    description: Occupancy insights
  - name: utilisation
    description: Utilisation insights
